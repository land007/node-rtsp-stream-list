var child_process=require("child_process"),util=require("util"),events=require("events"),milliseconds=5E3,Mpeg1Muxer=function(b){var e=setInterval(function(){(new Date).getTime()-c>milliseconds&&(console.log("----------------------------------timeOut----------------------------------"),a.kill(),d())},1E3),a=null,c=(new Date).getTime(),d=function(){null!=b&&(c=(new Date).getTime(),console.log("----------------------------------run----------------------------------"),console.log("options.url = "+b.url),
a=child_process.spawn("ffmpeg",["-rtsp_transport","tcp","-i",b.url,"-f","mpegts","-codec:v","mpeg1video","-bf","0","-s",process.env.WH||"1280x720","-b:v","800k","-q",process.env.QUALITY||3,"-r",process.env.REDUCE_FRAME||20,"-strict","-1","-muxdelay","0.001","-loglevel",process.env.FFMPEG_LOGLEVEL||24,"-"],{detached:!1}),a.stdout.on("data",function(a){c=(new Date).getTime();b.callback(a)}),a.stderr.on("data",function(a){global.process.stderr.write(a)}),a.stdout.on("end",function(){console.log("----------------------------------end----------------------------------")}))};
d();return{kill:function(){console.log("----------------------------------kill----------------------------------"+a.pid);clearInterval(e);a.kill()}}};util.inherits(Mpeg1Muxer,events.EventEmitter);module.exports=Mpeg1Muxer;